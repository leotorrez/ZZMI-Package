namespace = SlotFix

; Usage: -------------------------------------------------------------------------
;	Resource\ZZMI\Diffuse = Resource . . . Diffuse
;	Resource\ZZMI\NormalMap = Resource . . . NormalMap
;	Resource\ZZMI\LightMap = Resource . . . LightMap
;	Resource\ZZMI\MaterialMap = Resource . . . MaterialMap
;	run = CommandList\ZZMI\SetTextures
; -------------------------------------------------------------------------------

[CommandListSlotFix]
if ps == 037730.0
	ps-t2 = ref Resource\ZZMI\Diffuse 
	ps-t3 = ref Resource\ZZMI\LightMap 
elif ps == 037730.2
	ps-t2 = ref Resource\ZZMI\Diffuse 
	ps-t4 = ref Resource\ZZMI\LightMap 
elif ps == 037730.1
	ps-t2 = ref Resource\ZZMI\Diffuse 
elif ps == 037730.3
	ps-t3 = ref Resource\ZZMI\Diffuse 
	ps-t4 = ref Resource\ZZMI\NormalMap 
elif ps == 037730.5

	local $slot = 0
	run = CustomShader.GetGlowSlot
	store = $slot, cs-u0, 0
	
	if $slot == 8
		ps-t8 = ref Resource\ZZMI\GlowMap
	elif $slot == 9
		ps-t9 = ref Resource\ZZMI\GlowMap
	elif $slot == 10
		ps-t10 = ref Resource\ZZMI\GlowMap
	endif
else
	ps-t3 = ref Resource\ZZMI\Diffuse 
	ps-t4 = ref Resource\ZZMI\NormalMap 
	if ps == 037730.4
		ps-t6 = ref Resource\ZZMI\LightMap 
		ps-t7 = ref Resource\ZZMI\MaterialMap 
	else
		ps-t5 = ref Resource\ZZMI\LightMap 
		ps-t6 = ref Resource\ZZMI\MaterialMap 
	endif
endif

[CommandListSlotFixUnlessNull]
if ps == 037730.0
	ps-t2 = ref Resource\ZZMI\Diffuse unless_null
	ps-t3 = ref Resource\ZZMI\LightMap unless_null
elif ps == 037730.2
	ps-t2 = ref Resource\ZZMI\Diffuse unless_null
	ps-t4 = ref Resource\ZZMI\LightMap unless_null
elif ps == 037730.1
	ps-t2 = ref Resource\ZZMI\Diffuse unless_null
elif ps == 037730.3
	ps-t3 = ref Resource\ZZMI\Diffuse unless_null
	ps-t4 = ref Resource\ZZMI\NormalMap unless_null
elif ps == 037730.5

	local $slot = 0
	run = CustomShader.GetGlowSlot
	store = $slot, cs-u0, 0
	
	if $slot == 8
		ps-t8 = ref Resource\ZZMI\GlowMap unless_null
	elif $slot == 9
		ps-t9 = ref Resource\ZZMI\GlowMap unless_null
	elif $slot == 10
		ps-t10 = ref Resource\ZZMI\GlowMap unless_null
	endif
else
	ps-t3 = ref Resource\ZZMI\Diffuse unless_null
	ps-t4 = ref Resource\ZZMI\NormalMap unless_null
	if ps == 037730.4
		ps-t6 = ref Resource\ZZMI\LightMap unless_null
		ps-t7 = ref Resource\ZZMI\MaterialMap unless_null
	else
		ps-t5 = ref Resource\ZZMI\LightMap unless_null
		ps-t6 = ref Resource\ZZMI\MaterialMap unless_null
	endif
endif

[CustomShader.GetGlowSlot]
cs = get_glow_slot.hlsl

cs-u0 = ref ResourceUAV
cs-t8 = ref ps-t8
cs-t9 = ref ps-t9
cs-t10 = ref ps-t10

dispatch = 1, 1, 1

[ResourceUAV]
type = RWBuffer
format = R32_FLOAT
array = 1